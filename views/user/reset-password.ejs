<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password - Luxe & Co</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <style>
        .error-msg {
            color: #d32f2f;
            font-size: 13px;
            margin-top: 4px;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        luxeGold: "#C8A97E",
                        luxeLight: "#F8F4EF",
                        luxeDark: "#4b2e19",
                    }
                }
            }
        }
    </script>

</head>

<body class="bg-luxeLight font-[Poppins] min-h-screen flex items-center justify-center">

    <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-lg">

        <div class="w-full flex justify-center mb-6">
            <img src="https://cdn-icons-png.flaticon.com/512/9022/9022683.png" class="w-32 opacity-90 mx-auto mb-6" />
        </div>

        <h2 class="text-2xl font-semibold text-luxeDark text-center">Reset Your Password</h2>
        <p class="text-gray-600 text-sm text-center mt-1 mb-6">
            Create a strong new password below.
        </p>

        <form id="resetForm" class="space-y-4">

            <!-- NEW PASSWORD -->
            <div class="form-group">
                <label class="text-gray-800 font-medium text-sm">New Password</label>

                <div class="relative mt-2">
                    <input type="password" id="password"
                        class="w-full p-3 rounded-lg border border-gray-300 bg-gray-100 focus:ring-2 focus:ring-luxeGold">

                    <button type="button" onclick="togglePasswordVisibility('password','togglePassword')"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-600">
                        <i id="togglePassword" class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>

            <!-- CONFIRM PASSWORD -->
            <div class="form-group">
                <label class="text-gray-800 font-medium text-sm">Confirm Password</label>

                <div class="relative mt-2">
                    <input type="password" id="confirmPassword"
                        class="w-full p-3 rounded-lg border border-gray-300 bg-gray-100 focus:ring-2 focus:ring-luxeGold">

                    <button type="button" onclick="togglePasswordVisibility('confirmPassword','toggleConfirmPassword')"
                        class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-600">
                        <i id="toggleConfirmPassword" class="fa-solid fa-eye"></i>
                    </button>
                </div>
            </div>

            <button type="submit"
                class="w-full bg-luxeGold hover:bg-[#b39169] text-white font-medium p-3 rounded-lg shadow-lg transition">
                Reset Password
            </button>

        </form>

        <p class="text-center mt-5">
            <a href="/user/login" class="text-gray-600 hover:text-luxeDark hover:underline text-sm">
                ‚Üê Back to Login
            </a>
        </p>

    </div>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        function togglePasswordVisibility(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);

            if (input.type === "password") {
                input.type = "text";
                icon.classList.replace("fa-eye", "fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.replace("fa-eye-slash", "fa-eye");
            }
        }
    </script>
    <script type="module">
        import { validatePassword, PasswordMatch, showError, clearError } from "/utils/validation.js"

        const form = document.getElementById("resetForm")
        const passwordInput = document.getElementById("password")
        const confirmPasswordInput = document.getElementById("confirmPassword")

        form.addEventListener("submit", async function (e) {
            e.preventDefault();

            let valid = true;

            if (!validatePassword(passwordInput.value.trim())) {
                showError(passwordInput, "password must be at least 8 characters,contain a letter, a number, and a special character.")
                valid = false;
            } else {
                clearError(passwordInput);
            }

            if (!PasswordMatch(passwordInput.value, confirmPasswordInput.value)) {
                showError(confirmPasswordInput, "Password do not match")
                valid = false;
            } else {
                clearError(confirmPasswordInput)
            }
            if (!valid) return;

            const notyf = new Notyf({ position: { x: 'right', y: 'top' } });

            try {
                const response = await axios.post("/user/reset-password", { password: passwordInput.value })
                if (response.data.success) {
                    notyf.success(response.data.message)
                        window.location.href = response.data.redirect;
                        return;
                } else {
                    notyf.error(response.data.message)
                }
            } catch (error) {
                notyf.error("Server error, please try again later");
            }
        })

    </script>
</body>

</html>